// netlify/functions/yandex-proxy.js
const fetch = require('node-fetch');

exports.handler = async (event) => {
  const query = event.queryStringParameters.query;
  const folderId = "b1g7e9s4l4399vlbig8g";
  const iamToken = "ваш_токен_здесь"; // Замените на ваш токен!

  const response = await fetch('https://llm.api.cloud.yandex.net/foundationModels/v1/completion', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${iamToken}`,
      'x-folder-id': folderId
    },
    body: JSON.stringify({
      modelUri: `gpt://${folderId}/yandexgpt-lite`,
      completionOptions: {
        stream: false,
        temperature: 0.6,
        maxTokens: 2000
      },
      messages: [
        {
          role: "system",
          text: "Ты — эксперт по поиску товаров. Давай короткие практичные подсказки."
        },
        {
          role: "user",
          text: `Запрос: "${query}". Дай: 1. Ключевые слова (рус/англ/кит). 2. Как искать на Alibaba/1688/Yiwugo. 3. Как проверить товар.`
        }
      ]
    })
  });

  const data = await response.json();
  return {
    statusCode: 200,
    body: JSON.stringify(data.result.alternatives[0].message.text)
  };
};